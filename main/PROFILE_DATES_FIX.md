# Profile Dates Fix

## Issue
The Account Created and Last Login dates were showing "N/A" in the profile dashboard.

## Root Cause
The backend `/auth/register` endpoint was not returning the `createdAt` and `lastLoginAt` fields in the response, so the frontend never received these values.

## Solution Applied

### Backend Changes (main/backend/routes/auth.js)

1. **Updated `/auth/register` endpoint** to include dates in response:
```javascript
user: {
  id: user._id,
  firebaseUid: user.firebaseUid,
  email: user.email,
  displayName: user.displayName,
  photoURL: user.photoURL,
  provider: user.provider,
  createdAt: user.createdAt,        // ✅ Added
  lastLoginAt: user.lastLoginAt     // ✅ Added
}
```

2. **Updated `/auth/profile` PUT endpoint** to include dates:
```javascript
user: {
  id: user._id,
  firebaseUid: user.firebaseUid,
  email: user.email,
  displayName: user.displayName,
  photoURL: user.photoURL,
  provider: user.provider,
  createdAt: user.createdAt,        // ✅ Added
  lastLoginAt: user.lastLoginAt     // ✅ Added
}
```

### Frontend Changes (main/frontend/src/components/ProfileDashboard.jsx)

1. **Added debug logging** to see what data is received:
```javascript
console.log('User Profile Data:', userProfile);
console.log('Created At:', userProfile.createdAt);
console.log('Last Login At:', userProfile.lastLoginAt);
```

2. **Enhanced date formatting functions** with better error handling:
```javascript
const formatDate = (dateString) => {
  if (!dateString) return 'N/A';
  try {
    const date = new Date(dateString);
    if (isNaN(date.getTime())) return 'N/A';
    return date.toLocaleDateString('en-US', {
      year: 'numeric',
      month: 'long',
      day: 'numeric'
    });
  } catch {
    return 'N/A';
  }
};
```

## How to Test

### Option 1: Log Out and Log Back In (Recommended)
1. Click profile dropdown
2. Click "Log Out"
3. Log back in with your credentials
4. Navigate to Profile Dashboard
5. Dates should now display correctly

### Option 2: Clear Browser Data
1. Open browser DevTools (F12)
2. Go to Application/Storage tab
3. Clear all site data
4. Refresh the page
5. Log in again
6. Check Profile Dashboard

### Option 3: Check Console Logs
1. Open browser DevTools (F12)
2. Go to Console tab
3. Navigate to Profile Dashboard
4. Look for logs:
   - "User Profile Data: {...}"
   - "Created At: ..."
   - "Last Login At: ..."
5. Verify the dates are present in the data

## Expected Behavior

### Account Created
- Shows the date when the user first registered
- Format: "Month Day, Year" (e.g., "February 10, 2026")
- Comes from MongoDB `createdAt` field (auto-generated)

### Last Login
- Shows the date and time of the most recent login
- Format: "Month Day, Year, HH:MM AM/PM" (e.g., "February 10, 2026, 02:30 PM")
- Updated every time user logs in
- Comes from MongoDB `lastLoginAt` field (manually updated)

## Database Schema

The User model in MongoDB has these timestamp fields:

```javascript
{
  createdAt: Date,      // Auto-generated by Mongoose timestamps
  lastLoginAt: Date,    // Manually updated on each login
  timestamps: true      // Enables automatic createdAt/updatedAt
}
```

## Troubleshooting

### Still showing "N/A" after logging out/in?

1. **Check backend logs:**
   ```bash
   cd main/backend
   npm start
   ```
   Look for: "New user created in MongoDB" or "User login updated in MongoDB"

2. **Check MongoDB:**
   - Open MongoDB Atlas
   - Navigate to your database
   - Check the users collection
   - Verify `createdAt` and `lastLoginAt` fields exist

3. **Check browser console:**
   - Open DevTools (F12)
   - Look for the console.log output
   - Verify dates are in the userProfile object

4. **Check network requests:**
   - Open DevTools > Network tab
   - Filter by "register" or "profile"
   - Check the response payload
   - Verify dates are included

### Dates are undefined in console?

This means the backend is not returning the dates. Check:
1. Backend server is running the updated code
2. No errors in backend console
3. MongoDB connection is working
4. User document has the date fields

### Dates are present but showing "N/A"?

This means the date formatting is failing. Check:
1. Date format in MongoDB (should be ISO string)
2. Browser console for JavaScript errors
3. Date parsing logic in formatDate functions

## Additional Notes

- The `createdAt` field is automatically managed by Mongoose when `timestamps: true` is set
- The `lastLoginAt` field is manually updated in the `/auth/register` endpoint
- Both fields are stored as JavaScript Date objects in MongoDB
- They are serialized to ISO strings when sent to the frontend
- The frontend converts them back to Date objects for formatting

## Files Modified

1. `main/backend/routes/auth.js` - Added dates to API responses
2. `main/frontend/src/components/ProfileDashboard.jsx` - Added debug logging

## Status

✅ **Fixed** - Dates will now display correctly after logging out and back in.
